{% extends "qa/base.html" %}
{% load staticfiles %}


{% block top %}
<div class="col-md-7" >

    <ul class="nav nav-tabs nav-justified">
         <h2>
            <a class="qa-header" href="{% url 'qa_index' %}">
                <img width="40px" src="{% static 'img/qa_icon.png'%}" />
                Top Questions
            </a>
        </h2>
        <li role="presentation" {% if active_tab == 'latest' %}class="active"{% endif %} style="padding-top:10px;padding-left=10px;"><a href="#latest" data-toggle="tab"><i class="fas fa-th-list"></i> Latest</a></li>
        <li role="presentation" {% if active_tab == 'unans' %}class="active"{% endif %} style="padding-top:10px;"><a href="#unans" data-toggle="tab"><i class="fas fa-question"></i> Unanswered <span class="badge">{{ totalnoans }}</span></a></li>
        <li role="presentation" {% if active_tab == 'reward' %}class="active"{% endif %} style="padding-top:10px;"><a href="#reward" data-toggle="tab"><i class="fas fa-star"></i> Most Rewarding <span class="badge">{{ reward | length }}</span></a></li>
    </ul>
    
</div>
{% endblock top %}

{% block contentqa %}
<div class="col-md-8">
<div class="tab-content">
<div class="tab-pane {% if active_tab == 'latest' %}active{% endif %}" id="latest">
{% if questions %}
  {% for question in questions %}
    
    <div class="row">
<!--
      bug au niveau de l'affichage du nombre de reponse lorsque l'on suit un tag  
-->
        <div class="col-sm-2 ans"><small><div class="ques">{{ question.num_answers }}</div>Answers</small></div>
        
        <div class="col-sm-2 ans"><small><div class="ques">{{ question.hit_count.hits }}</div>Views</small></div>
        <p>
            
                
                    {% if question.reward %}<i class="fas fa-fire"></i>{% endif %}
                    <a class="subject" href="{% url 'qa_detail' question.id %}">{{ question.title }}</a>
                    <small>{{ question.pub_date }}</small>
                
          <br/>
            
                
                    {% for tag in question.tags.all %}
                        <a href="{% url 'qa_tag' tag.slug %}"><tag>{{ tag.slug }}</tag></a>
                    {% endfor %}
                
            
       </p>
    </div>
    <hr>
  {% endfor %}

<div class="pagination">
  {% if is_paginated %}
      <div class="pagination">
          <span class="page-links">
              {% if page_obj.has_previous %}
                  <a href="{% url 'qa_index' %}?page={{ page_obj.previous_page_number }}">previous</a>
              {% endif %}
              <span class="page-current">
                  Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
              </span>
              {% if page_obj.has_next %}
                  <a href="{% url 'qa_index' %}?page={{ page_obj.next_page_number }}">next</a>
              {% endif %}
          </span>
      </div>
  {% endif %}
</div>

{% else %}
<div class="alert alert-warning" role="alert">No Questions are available!</div>
{% endif %}
</div>

<div class="tab-pane {% if active_tab == 'unans' %}active{% endif %}" id="unans">
{% if noans %}
  {% for question in noans %}
  <div class="row">
  <div class="col-sm-2 ans"><small><div class="ques">{{ question.num_answers }}</div>Answers</small></div>
  <div class="col-sm-2 ans"><small><div class="ques">{{ question.hit_count.hits }}</div>Views</small></div>
  <p>
    {% if question.num_answers %}<i class="fas fa-fire"></i>{% endif %} <a class="subject" href="{% url 'qa_detail' question.id %}">{{ question.title }}</a>
    <small> {{ question.pub_date }}</small>
    <br/>
    
    {% for tag in question.tags.all %}
        <a href="{% url 'qa_tag' tag.slug %}"><tag>{{ tag.slug }}</tag></a>
    {% endfor %}
    
  </p>
</div>
<hr>
  {% endfor %}

{% else %}
<div class="alert alert-warning" role="alert">No Questions are available!</div>
{% endif %}
<div class="pagination">
    <span class="step-links">
        {% if noans.has_previous %}
            <a href="?noans_page={{ noans.previous_page_number }}&active_tab=unans">previous</a>
        {% endif %}

        <span class="current">
            Page {{ noans.number }} of {{ noans.paginator.num_pages }}.
        </span>

        {% if noans.has_next %}
            <a href="?noans_page={{ noans.next_page_number }}&active_tab=unans">next</a>
        {% endif %}
    </span>
</div>
</div>

<div class="tab-pane {% if active_tab == 'reward' %}active{% endif %}" id="reward">
{% if reward %}
  {% for question in reward %}
  <div class="row">
  <div class="col-sm-2 ans"><small><div class="ques">{{ question.num_answers }}</div>Answers</small></div>
  <div class="col-sm-2 ans"><small><div class="ques">{{ question.hit_count.hits }}</div>Views</small></div>
  <p>
    {% if question.num_answers %}<i class="fas fa-fire"></i>{% endif %} <a class="ques" href="{% url 'qa_detail' question.id %}">{{ question.title }}</a>
    <br/>
    {% for tag in question.tags.all %}
        <a href="{% url 'qa_tag' tag.slug %}"><tag>{{ tag.slug }}</tag></a>
    {% endfor %}
    <small> {{ question.pub_date}}</small>
  </p>
</div>
<hr>
  {% endfor %}

{% else %}
<div class="alert alert-warning" role="alert">No Questions are available!</div>
{% endif %}
</div>

  </div>
</div>

<div class="col-md-4">

  <div class="card">
    <div class="card-body">
      <h4>Total Questions: {{ totalcount }}</h4>
      <h4>Total Answers: {{ anscount }}</h4>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <h3 class="card-title"><i class="fas fa-tags"></i> Recent Tags</h3>
    </div>
    <div class="card-body">
      {% for tag in tags %}
          <a href="{% url 'qa_tag' tag.slug %}"><tag>{{ tag.slug }}</tag></a>
      {% endfor %}
    </div>
  </div>

  {% if noans.count %}
  <div class="card bg-warning">
    <div class="card-heading">
      <h3 class="card-title">Unanswered Questions</h3>
    </div>
    <div class="card-body">
    <ul>
      {% for question in noans %}
      <li><a href="{% url 'qa_detail' question.id %}">{{ question.title }}</a></li>
      {% endfor %}
    </ul>
    </div>
  </div>
  {% endif %}
  {% comment %}
  {% if user.is_authenticated %}

  <div class="span3 well">
    <center>
      <a href="{% url 'qa_profile' user.id %}" data-toggle="modal">
        {% if user.userqaprofile.picture %}
          <img src="{{ user.userqaprofile.picture }}" name="aboutme" width="100" height="100" class="img-circle">
        {% else %}
          <img src="{% static 'qa/user.png' %}" name="aboutme" width="100" height="100" class="img-circle">
        {% endif %}
      </a>
      <h3>{{ user.first_name }} {{ user.last_name }}</h3>
      <a href="/profile/{{ user.id }}">My Profile</a> | <!--to consider-->
      <a href="/logout/">Logout</a>
    </center>
  </div>
  {% else %}
  <a class="btn btn-block btn-success" href="/login"><i class="fas fa-user"></i> Login | Sign Up</a><br/>
  {% endif %}{% endcomment %}

</div>

{% endblock contentqa %}
